// title
title Warehouse Management System - Complete Production Schema

// ================================================================
// ORGANIZATION & WORKSPACE MANAGEMENT
// ================================================================

organizations [icon: building, color: blue] {
  organization_id int pk
  name string unique
  address string
  contact_info jsonb
  is_active bool
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

organization_settings [icon: settings, color: blue] {
  organization_id int pk fk
  setting_key string pk
  setting_value jsonb
  updated_at timestamp
}

branches [icon: building, color: blue] {
  branch_id int pk
  organization_id int fk
  name string
  address string
  phone_number string
  is_active bool
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

branch_settings [icon: cog, color: blue] {
  branch_id int pk fk
  setting_key string pk
  setting_value jsonb
  updated_at timestamp
}

workspace_invitations [icon: mail, color: blue] {
  invitation_id int pk
  organization_id int fk
  invitation_code string unique
  created_by_user_id int fk
  created_at timestamp
  expires_at timestamp
  status_type_id int fk
}

// ================================================================
// USER MANAGEMENT & AUTHENTICATION
// ================================================================

users [icon: user, color: green] {
  user_id int pk
  organization_id int fk
  username string unique
  password_hash string
  full_name string
  email string unique
  is_active bool
  preferences jsonb
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

user_branch_assignments [icon: users, color: green] {
  user_id int pk fk
  branch_id int pk fk
  assignment_status_type_id int fk
  assigned_at timestamp
}

roles [icon: shield, color: green] {
  role_id int pk
  organization_id int fk
  name string
  description string
  is_system_default bool
  created_at timestamp
}

role_permissions [icon: key, color: green] {
  role_permission_id int pk
  role_id int fk
  permission_category string
  permission_bits bigint
  scope_type string
}

user_role_assignments [icon: link, color: green] {
  user_role_assignment_id int pk
  user_id int fk
  role_id int fk
  branch_id int fk
  assigned_at timestamp
}

// ================================================================
// MASTER DATA MANAGEMENT
// ================================================================

categories [icon: tag, color: orange] {
  category_id int pk
  organization_id int fk
  name string
  path ltree
  is_active bool
  created_at timestamp
  is_deleted bool
  deleted_at timestamp
}

category_settings [icon: sliders, color: orange] {
  category_id int pk fk
  setting_key string pk
  setting_value jsonb
  updated_at timestamp
}

brands [icon: award, color: orange] {
  brand_id int pk
  organization_id int fk
  name string
  is_active bool
  created_at timestamp
  is_deleted bool
  deleted_at timestamp
}

products [icon: package, color: orange] {
  product_id int pk
  organization_id int fk
  name string
  description string
  category_id int fk
  brand_id int fk
  storage_requirement_type_id int fk
  tracking_method_type_id int fk
  shelf_life_days int
  reorder_point int
  reorder_point_override int
  is_active bool
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

product_type_templates [icon: file-text, color: orange] {
  template_id int pk
  organization_id int fk
  template_name string
  field_definitions jsonb
  created_at timestamp
}

product_variants [icon: copy, color: orange] {
  sku_id int pk
  product_id int fk
  sku_code string unique
  description string
  cost_price decimal
  selling_price decimal
  unit_of_measure_id int fk
  weight_kg decimal
  volume_m3 decimal
  temperature_sensitive bool
  stacking_limit int
  custom_fields jsonb
  is_active bool
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

product_barcodes [icon: maximize, color: orange] {
  barcode_id int pk
  sku_id int fk
  barcode_type_id int fk
  barcode_value string unique
  created_at timestamp
}

suppliers [icon: truck, color: orange] {
  supplier_id int pk
  organization_id int fk
  name string
  contact_person string
  email string
  phone string
  default_lead_time_days int
  is_active bool
  created_at timestamp
  is_deleted bool
  deleted_at timestamp
}

// ================================================================
// WAREHOUSE LAYOUT & STORAGE
// ================================================================

storage_zones [icon: map-pin, color: purple] {
  zone_id int pk
  branch_id int fk
  name string
  path ltree
  zone_type_id int fk
  storage_block_type string
  zone_attributes jsonb
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

// ================================================================
// PURCHASE ORDER MANAGEMENT
// ================================================================

purchase_orders [icon: clipboard, color: red] {
  purchase_order_id int pk
  organization_id int fk
  branch_id int fk
  code string unique
  supplier_id int fk
  ordered_at timestamp
  expected_delivery_at timestamp
  created_by_user_id int fk
  purchase_order_status_type_id int fk
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

purchase_order_details [icon: list, color: red] {
  purchase_order_detail_id int pk
  purchase_order_id int fk
  sku_id int fk
  quantity_ordered int
  unit_cost decimal
  quantity_received int
}

// ================================================================
// WORK SESSIONS
// ================================================================

work_sessions [icon: clock, color: cyan] {
  session_id int pk
  organization_id int fk
  branch_id int fk
  session_type_id int fk
  session_code string unique
  assigned_user_id int fk
  session_status_type_id int fk
  started_at timestamp
  completed_at timestamp
  verified_at timestamp
  verified_by_user_id int fk
  rejection_reason string
  purchase_order_id int fk
  outbound_order_id int fk
  transfer_order_id int fk
  created_at timestamp
}

session_line_items [icon: list, color: cyan] {
  line_item_id int pk
  session_id int fk
  sku_id int fk
  expected_quantity int
  actual_quantity int
  zone_id int fk
  batch_id int fk
  scanned_at timestamp
  notes string
}

session_metrics [icon: bar-chart, color: cyan] {
  metric_id int pk
  session_id int fk
  total_time_seconds int
  total_items_processed int
  accuracy_rate decimal
  calculated_at timestamp
}

// ================================================================
// INVENTORY TRACKING
// ================================================================

inventory_batches [icon: layers, color: teal] {
  batch_id int pk
  organization_id int fk
  sku_id int fk
  zone_id int fk
  quantity int
  supplier_batch_number string
  internal_batch_number string
  received_at date
  manufacturing_date date
  expires_at date
  batch_status_type_id int fk
  created_at timestamp
  is_deleted bool
  deleted_at timestamp
}

serial_numbers [icon: hash, color: teal] {
  serial_number_id int pk
  organization_id int fk
  serial_number string unique
  sku_id int fk
  batch_id int fk
  zone_id int fk
  serial_status_type_id int fk
  warranty_expires_at date
  purchase_order_id int fk
  created_at timestamp
  updated_at timestamp
}

inventory_transactions [icon: activity, color: teal] {
  transaction_id bigint pk
  organization_id int fk
  batch_id int fk
  serial_number_id int fk
  quantity_before int
  quantity_change int
  quantity_after int
  inventory_transaction_type_id int fk
  created_at timestamp
  created_by_user_id int fk
  notes string
  purchase_order_detail_id int fk
  transfer_order_detail_id int fk
  work_session_id int fk
  adjustment_request_detail_id int fk
  outbound_order_detail_id int fk
}

// ================================================================
// OUTBOUND OPERATIONS
// ================================================================

outbound_orders [icon: send, color: yellow] {
  outbound_order_id int pk
  organization_id int fk
  branch_id int fk
  order_code string unique
  order_date timestamp
  requested_ship_date timestamp
  tracking_number string
  created_by_user_id int fk
  outbound_status_type_id int fk
  created_at timestamp
  updated_at timestamp
  is_deleted bool
  deleted_at timestamp
}

outbound_order_details [icon: package, color: yellow] {
  outbound_order_detail_id int pk
  outbound_order_id int fk
  sku_id int fk
  quantity_requested int
  quantity_picked int
  quantity_packed int
}

// ================================================================
// INVENTORY ADJUSTMENTS
// ================================================================

adjustment_requests [icon: edit, color: pink] {
  adjustment_request_id int pk
  organization_id int fk
  branch_id int fk
  request_code string unique
  requested_by_user_id int fk
  requested_at timestamp
  approved_by_user_id int fk
  approved_at timestamp
  adjustment_status_type_id int fk
  resolution_notes string
  created_at timestamp
}

adjustment_request_details [icon: list, color: pink] {
  adjustment_detail_id int pk
  adjustment_request_id int fk
  batch_id int fk
  sku_id int fk
  expected_quantity int
  actual_quantity int
  variance_quantity int
  cost_impact decimal
  reason_type_id int fk
  custom_reason_notes string
}

// ================================================================
// SUPPLIER RETURNS
// ================================================================

return_requests [icon: rotate-ccw, color: brown] {
  return_request_id int pk
  organization_id int fk
  branch_id int fk
  request_code string unique
  supplier_id int fk
  requested_by_user_id int fk
  requested_at timestamp
  return_status_type_id int fk
  created_at timestamp
  is_deleted bool
  deleted_at timestamp
}

return_request_details [icon: list, color: brown] {
  return_detail_id int pk
  return_request_id int fk
  batch_id int fk
  sku_id int fk
  quantity_to_return int
  reason_type_id int fk
  custom_reason_notes string
  expected_credit_amount decimal
}

// ================================================================
// INTERNAL TRANSFERS
// ================================================================

transfer_orders [icon: truck, color: indigo] {
  transfer_order_id int pk
  organization_id int fk
  transfer_code string unique
  source_branch_id int fk
  destination_branch_id int fk
  created_by_user_id int fk
  created_at timestamp
  expected_delivery_at timestamp
  actual_delivery_at timestamp
  tracking_number string
  transfer_status_type_id int fk
  is_deleted bool
  deleted_at timestamp
}

transfer_order_details [icon: package, color: indigo] {
  transfer_order_detail_id int pk
  transfer_order_id int fk
  sku_id int fk
  quantity_requested int
  quantity_shipped int
  quantity_received int
}

// ================================================================
// NOTIFICATIONS & ALERTS
// ================================================================

notifications [icon: bell, color: gray] {
  notification_id int pk
  organization_id int fk
  notification_category_type_id int fk
  notification_type string
  recipient_user_id int fk
  title string
  message string
  priority_type_id int fk
  action_url string
  related_entity_type string
  related_entity_id int
  created_at timestamp
  read_at timestamp
  dismissed_at timestamp
}

// ================================================================
// REPORTING & ANALYTICS
// ================================================================

demand_forecasts [icon: trending-up, color: violet] {
  forecast_id int pk
  organization_id int fk
  sku_id int fk
  forecast_date date
  forecast_type_id int fk
  predicted_demand decimal
  confidence_interval decimal
  calculation_method string
  created_at timestamp
}

report_templates [icon: file-text, color: violet] {
  template_id int pk
  organization_id int fk
  template_name string
  description string
  owner_user_id int fk
  template_config jsonb
  sharing_scope_type_id int fk
  created_at timestamp
  updated_at timestamp
}

// ================================================================
// ATTACHMENTS & DOCUMENTS
// ================================================================

attachments [icon: paperclip, color: olive] {
  attachment_id int pk
  organization_id int fk
  file_name string
  file_path string
  file_size_bytes bigint
  mime_type string
  uploaded_by_user_id int fk
  uploaded_at timestamp
  entity_type string
  entity_id int
  notes string
}

// ================================================================
// AUDIT & COMPLIANCE
// ================================================================

audit_logs [icon: file-text, color: gray] {
  log_id bigint pk
  organization_id int fk
  user_id int fk
  action_type_id int fk
  entity_type string
  entity_id int
  field_name string
  old_value jsonb
  new_value jsonb
  ip_address string
  notes string
  created_at timestamp
}

// ================================================================
// SYSTEM LOOKUPS
// ================================================================

system_lookups [icon: type, color: black] {
  id int pk
  lookup_type string
  lookup_code string
  lookup_value string
  description string
  sort_order int
}

// ================================================================
// RELATIONSHIPS
// ================================================================

// Organizations & Branches
branches.organization_id > organizations.organization_id
organization_settings.organization_id > organizations.organization_id
branch_settings.branch_id > branches.branch_id
workspace_invitations.organization_id > organizations.organization_id
workspace_invitations.created_by_user_id > users.user_id
workspace_invitations.status_type_id > system_lookups.id

// Users & Authentication
users.organization_id > organizations.organization_id
user_branch_assignments.user_id > users.user_id
user_branch_assignments.branch_id > branches.branch_id
user_branch_assignments.assignment_status_type_id > system_lookups.id
roles.organization_id > organizations.organization_id
role_permissions.role_id > roles.role_id
user_role_assignments.user_id > users.user_id
user_role_assignments.role_id > roles.role_id
user_role_assignments.branch_id > branches.branch_id

// Master Data
categories.organization_id > organizations.organization_id
category_settings.category_id > categories.category_id
brands.organization_id > organizations.organization_id
products.organization_id > organizations.organization_id
products.category_id > categories.category_id
products.brand_id > brands.brand_id
products.storage_requirement_type_id > system_lookups.id
products.tracking_method_type_id > system_lookups.id
product_type_templates.organization_id > organizations.organization_id
product_variants.product_id > products.product_id
product_variants.unit_of_measure_id > system_lookups.id
product_barcodes.sku_id > product_variants.sku_id
product_barcodes.barcode_type_id > system_lookups.id
suppliers.organization_id > organizations.organization_id

// Warehouse Layout
storage_zones.branch_id > branches.branch_id
storage_zones.zone_type_id > system_lookups.id

// Purchase Orders
purchase_orders.organization_id > organizations.organization_id
purchase_orders.branch_id > branches.branch_id
purchase_orders.supplier_id > suppliers.supplier_id
purchase_orders.created_by_user_id > users.user_id
purchase_orders.purchase_order_status_type_id > system_lookups.id
purchase_order_details.purchase_order_id > purchase_orders.purchase_order_id
purchase_order_details.sku_id > product_variants.sku_id

// Work Sessions
work_sessions.organization_id > organizations.organization_id
work_sessions.branch_id > branches.branch_id
work_sessions.session_type_id > system_lookups.id
work_sessions.assigned_user_id > users.user_id
work_sessions.session_status_type_id > system_lookups.id
work_sessions.verified_by_user_id > users.user_id
work_sessions.purchase_order_id > purchase_orders.purchase_order_id
work_sessions.outbound_order_id > outbound_orders.outbound_order_id
work_sessions.transfer_order_id > transfer_orders.transfer_order_id
session_line_items.session_id > work_sessions.session_id
session_line_items.sku_id > product_variants.sku_id
session_line_items.zone_id > storage_zones.zone_id
session_line_items.batch_id > inventory_batches.batch_id
session_metrics.session_id > work_sessions.session_id

// Inventory
inventory_batches.organization_id > organizations.organization_id
inventory_batches.sku_id > product_variants.sku_id
inventory_batches.zone_id > storage_zones.zone_id
inventory_batches.batch_status_type_id > system_lookups.id
serial_numbers.organization_id > organizations.organization_id
serial_numbers.sku_id > product_variants.sku_id
serial_numbers.batch_id > inventory_batches.batch_id
serial_numbers.zone_id > storage_zones.zone_id
serial_numbers.serial_status_type_id > system_lookups.id
serial_numbers.purchase_order_id > purchase_orders.purchase_order_id
inventory_transactions.organization_id > organizations.organization_id
inventory_transactions.batch_id > inventory_batches.batch_id
inventory_transactions.serial_number_id > serial_numbers.serial_number_id
inventory_transactions.inventory_transaction_type_id > system_lookups.id
inventory_transactions.created_by_user_id > users.user_id
inventory_transactions.purchase_order_detail_id > purchase_order_details.purchase_order_detail_id
inventory_transactions.transfer_order_detail_id > transfer_order_details.transfer_order_detail_id
inventory_transactions.work_session_id > work_sessions.session_id
inventory_transactions.adjustment_request_detail_id > adjustment_request_details.adjustment_detail_id
inventory_transactions.outbound_order_detail_id > outbound_order_details.outbound_order_detail_id

// Outbound Operations
outbound_orders.organization_id > organizations.organization_id
outbound_orders.branch_id > branches.branch_id
outbound_orders.created_by_user_id > users.user_id
outbound_orders.outbound_status_type_id > system_lookups.id
outbound_order_details.outbound_order_id > outbound_orders.outbound_order_id
outbound_order_details.sku_id > product_variants.sku_id

// Adjustments
adjustment_requests.organization_id > organizations.organization_id
adjustment_requests.branch_id > branches.branch_id
adjustment_requests.requested_by_user_id > users.user_id
adjustment_requests.approved_by_user_id > users.user_id
adjustment_requests.adjustment_status_type_id > system_lookups.id
adjustment_request_details.adjustment_request_id > adjustment_requests.adjustment_request_id
adjustment_request_details.batch_id > inventory_batches.batch_id
adjustment_request_details.sku_id > product_variants.sku_id
adjustment_request_details.reason_type_id > system_lookups.id

// Returns
return_requests.organization_id > organizations.organization_id
return_requests.branch_id > branches.branch_id
return_requests.supplier_id > suppliers.supplier_id
return_requests.requested_by_user_id > users.user_id
return_requests.return_status_type_id > system_lookups.id
return_request_details.return_request_id > return_requests.return_request_id
return_request_details.batch_id > inventory_batches.batch_id
return_request_details.sku_id > product_variants.sku_id
return_request_details.reason_type_id > system_lookups.id

// Transfers
transfer_orders.organization_id > organizations.organization_id
transfer_orders.source_branch_id > branches.branch_id
transfer_orders.destination_branch_id > branches.branch_id
transfer_orders.created_by_user_id > users.user_id
transfer_orders.transfer_status_type_id > system_lookups.id
transfer_order_details.transfer_order_id > transfer_orders.transfer_order_id
transfer_order_details.sku_id > product_variants.sku_id

// Notifications
notifications.organization_id > organizations.organization_id
notifications.notification_category_type_id > system_lookups.id
notifications.recipient_user_id > users.user_id
notifications.priority_type_id > system_lookups.id

// Reporting
demand_forecasts.organization_id > organizations.organization_id
demand_forecasts.sku_id > product_variants.sku_id
demand_forecasts.forecast_type_id > system_lookups.id
report_templates.organization_id > organizations.organization_id
report_templates.owner_user_id > users.user_id
report_templates.sharing_scope_type_id > system_lookups.id

// Attachments
attachments.organization_id > organizations.organization_id
attachments.uploaded_by_user_id > users.user_id

// Audit
audit_logs.organization_id > organizations.organization_id
audit_logs.user_id > users.user_id
audit_logs.action_type_id > system_lookups.id